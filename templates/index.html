{% include "header.html" %}

<!-- Main Content-->
<div class="container px-4 px-lg-5 mt-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
        {% for item in all_items %}
        <div class="col-sm-6 col-md-4 col-lg-3 mb-3 mt-3">
            <div class="card h-100 shadow-sm" style="max-width: 220px; margin: auto;">
                <!-- Product image -->
                <img class="card-img-top" src="{{ item.image }}" alt="{{ item.name }}"
                     style="width: 100%; height: 120px; object-fit: contain; border-radius: 0.5rem;"/>

                <!-- Make card-body flex column -->
                <div class="card-body text-center p-2 d-flex flex-column">
                    <!-- Product name -->
                    <h6 class="fw-bold">{{ item.name }}</h6>

                    <!-- Product description -->
                    <p class="text-muted small">{{ item.description }}</p>

                    <!-- Everything below this gets pushed to the bottom -->
                    <div class="mt-auto">
                        <!-- Product price -->
                        <p class="fw-bold small">Price: ${{ "%.2f"|format(item.price) }}</p>

                        <!-- Quantity selector -->
                        <form action="{{ url_for('add_to_cart', item_id=item.id) }}" method="POST">
                            <div class="d-flex justify-content-center align-items-center mb-2">
                                <label for="quantity-{{ item.id }}" class="me-1 mb-0 small">Qty:</label>
                                <input
                                        id="quantity-{{ item.id }}"
                                        name="quantity"
                                        type="number"
                                        min="1"
                                        max="{{ item.quantity }}"
                                        value="1"
                                        class="form-control form-control-sm"
                                        style="width: 60px; height: 28px; font-size: 0.8rem;"
                                />
                            </div>

                            <!-- Buttons Row -->
                            <div class="d-flex justify-content-center gap-1">
                                <!-- Add to Cart button -->
                                <button type="submit" class="btn btn-sm btn-primary"
                                        style="font-size: 0.8rem; padding: 2px 6px;"
                                        {% if item.quantity== 0 %}disabled{% endif %}>
                                    {% if item.quantity == 0 %}
                                    Out
                                    {% else %}
                                    Add
                                    {% endif %}
                                </button>

                                {% if current_user.id == 1 %}
                                <!-- Admin Edit + Delete buttons -->
                                <a class="btn btn-sm btn-warning" href="{{ url_for('edit_item', item_id=item.id) }}"
                                   style="font-size: 0.8rem; padding: 2px 6px;">Edit</a>
                                <a class="btn btn-sm btn-danger" href="{{ url_for('delete_item', item_id=item.id) }}"
                                   style="font-size: 0.8rem; padding: 2px 6px;">âœ˜</a>
                                {% endif %}
                            </div>
                        </form>

                        <!-- Flash messages -->
                        {% if updated_item == item.id %}
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show small py-1 px-2 mt-2"
                             role="alert" id="flash-message-{{ item.id }}">
                            {{ message }}
                            <button type="button" class="btn-close btn-sm p-2" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                        {% endif %}
                        {% endwith %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- New Post -->
        <!-- Only show Create Post button if user id is 1 (admin user) -->
        {% if current_user.id == 1: %}
        <div class="d-flex justify-content-center mb-4 mt-5">
            <a
                    class="btn btn-primary"
                    href="{{url_for('add_new_item')}}"
            >Add New Item</a
            >
        </div>
        {% endif %}
    </div>
</div>
{% include "footer.html" %}
